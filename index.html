<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Hangman game</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        div.centered {
            position: absolute;
            border: 3px solid red;
            padding: 10px;
            top: 50%;
            left: 50%;
        }

        span.char {
            margin-right: 4px;
        }

        input.invalid {
            border: 2px solid red;
        }
    </style>
</head>
    <body>
        <div class="centered"
             x-data="{ word: $store.defaultStore.word }">
            <div id="word">
                <template x-for="(char, index) in word">
                    <span
                        class="char"
                        x-data="charComponent()"
                        x-text="hidden ? hiddenChar(char) : char"
                        @showLetter-index="hidden=false">
                    </span>
                </template>
            </div>
            <div class="guess">
                <div>What's your next guess?</div>
                <div>
                    <input class="guess"
                           type="text"
                           maxlength="1" />
                    <button type="button"
                            id="confirmGuess">
                        Confirm
                    </button>
                </div>
            </div>
        </div>
    </body>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.store('defaultStore', {
                word: generateWordToBeGuessed(),
                status: initStatus(),
            })
        })

        let input = document.querySelector('input.guess')
        let wordToBeGuessed

        let charComponent = () => {
            return {
                hidden: true,
                show() {
                    this.hidden = false
                }
            }
        }

        let wordComponent = () => {
            return {
                word: $store.defaultStore.word
            }
        }

        document.querySelector('button#confirmGuess')
                .addEventListener(
                    'click',
                    function () {
                        let guess = input.value.toLowerCase()
                        let inputIsValid = guess >= 'a' && guess <= 'z'
                        let wordElement = document.querySelector('div#word')

                        if (!inputIsValid) {
                            input.classList.add('invalid')
                            return
                        }

                        for (let i = 0; i < wordToBeGuessed.length; i++) {
                            if(wordToBeGuessed[i] === guess) {
                                //let letterToShow = wordElement.getElementsByTagName('span').item(i)
                                let event = new Event('showLetter-' + i);
                                this.dispatchEvent(event)
                            }
                        }
                    }
        )

        input.addEventListener(
            'keyup',
            function () {
                input.classList.remove('invalid')
            }
        )

        function generateWordToBeGuessed() {
            let words = [
                'andare',
                'ape',
                'arbusto',
                'artiglio',
                'automobile',
                'bello',
                'bistecca',
                'campana',
                'cane',
                'cespuglio',
                'ciao',
                'cilecca',
                'ciliegia',
                'confetto',
                'coniglio',
                'correre',
                'cupola',
                'era',
                'finestra',
                'gatto',
                'gelato',
                'maestro',
                'mare',
                'minestra',
                'pane',
                'pollo',
                'rane',
                'sazio',
                'software',
                'tempo',
            ];

            let index = Math.floor(
                Math.random() * words.length
            );

            return wordToBeGuessed = words[index];
        }

        function initStatus() {
            let status = []

            for (let i = 0; i < $store.defaultStore.word.length; i++) {
                status[i] = 'hidden';
            }

            return status
        }

        function hiddenChar(char) {
            return '_';
        }
    </script>
</html>
